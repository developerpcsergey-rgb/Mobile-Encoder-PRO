<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üîê –ú–æ–±–∏–ª—å–Ω—ã–π –®–∏—Ñ—Ä–∞—Ç–æ—Ä PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border-radius: 12px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--dark);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .security-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            gap: 5px;
        }
        
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab {
            flex: 1;
            padding: 15px 5px;
            text-align: center;
            background: none;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .tab i {
            font-size: 1.2rem;
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .tab-content {
            display: none;
            padding: 20px 15px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
        }
        
        .card-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            z-index: 2;
        }
        
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 56px;
        }
        
        .btn:active {
            transform: translateY(2px);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: var(--gray);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 0.95rem;
        }
        
        .alert i {
            font-size: 1.2rem;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .alert-info {
            background: #e3f2fd;
            color: #0c5460;
            border-left: 4px solid var(--primary);
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning);
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--danger);
        }
        
        .result-container {
            margin-top: 25px;
            display: none;
        }
        
        .result-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
            border: 1px solid #e9ecef;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 15px;
            background: var(--light);
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            text-align: center;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .file-input-label:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .selected-files-list {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e9ecef;
        }
        
        .file-item-info {
            flex-grow: 1;
        }
        
        .file-item-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .file-item-size {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .remove-file-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
        }
        
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .status-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .footer {
            text-align: center;
            padding: 20px 15px;
            color: var(--gray);
            font-size: 0.85rem;
            border-top: 1px solid #e9ecef;
            background: var(--light);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .password-strength {
            margin-top: 8px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .strength-meter {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease, background 0.3s ease;
        }
        
        .settings-group {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .settings-group:last-child {
            border-bottom: none;
        }
        
        .settings-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-extension-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .extension-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .custom-extension {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .custom-extension input {
            flex-grow: 1;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
        }
        
        .folder-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }
        
        .folder-path {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .file-output-name {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .file-output-name input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .file-output-name input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .locked-folder {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .locked-folder i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                margin: 0 5px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .tab {
                padding: 12px 5px;
                font-size: 0.85rem;
            }
            
            .tab i {
                font-size: 1rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                padding: 14px 16px;
                font-size: 0.95rem;
                min-height: 52px;
            }
            
            .buttons-grid {
                grid-template-columns: 1fr;
            }
            
            textarea.form-control {
                min-height: 100px;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 15px 10px;
            }
            
            .tab-content {
                padding: 15px 10px;
            }
            
            .form-control {
                padding: 12px;
            }
            
            .btn {
                padding: 12px 14px;
            }
            
            .alert {
                padding: 12px;
                font-size: 0.9rem;
            }
        }
        
        /* –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º */
        @media (orientation: portrait) {
            .buttons-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* –õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π —Ä–µ–∂–∏–º */
        @media (orientation: landscape) and (max-height: 500px) {
            .container {
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .header {
                padding: 10px 15px;
            }
            
            .tab {
                padding: 10px 5px;
            }
        }
        
        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        @media (prefers-color-scheme: dark) {
            :root {
                --light: #2d3748;
                --dark: #f7fafc;
                --gray: #a0aec0;
            }
            
            body {
                background: linear-gradient(135deg, #4c51bf 0%, #702459 100%);
            }
            
            .container {
                background: #1a202c;
                color: var(--dark);
            }
            
            .card {
                background: #2d3748;
                border-color: #4a5568;
            }
            
            .form-control {
                background: #2d3748;
                border-color: #4a5568;
                color: var(--dark);
            }
            
            .result-box {
                background: #2d3748;
                border-color: #4a5568;
            }
            
            .file-input-label {
                background: #2d3748;
                border-color: #4a5568;
                color: var(--gray);
            }
            
            .alert-info {
                background: #2c5282;
                color: #bee3f8;
            }
            
            .alert-warning {
                background: #744210;
                color: #feebc8;
            }
            
            .alert-success {
                background: #22543d;
                color: #c6f6d5;
            }
            
            .alert-danger {
                background: #742a2a;
                color: #fed7d7;
            }
            
            .file-item {
                background: #2d3748;
                border-color: #4a5568;
            }
            
            .settings-group {
                border-bottom: 1px solid #4a5568;
            }
            
            .custom-extension input {
                background: #2d3748;
                border-color: #4a5568;
                color: var(--dark);
            }
            
            .folder-info {
                background: #2d3748;
                border-color: #4a5568;
            }
            
            .folder-path {
                background: #1a202c;
                border-color: #4a5568;
            }
            
            .file-output-name input {
                background: #2d3748;
                border-color: #4a5568;
                color: var(--dark);
            }
            
            .locked-folder {
                background: linear-gradient(135deg, #4c51bf 0%, #702459 100%);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1><i class="fas fa-lock"></i> –ú–æ–±–∏–ª—å–Ω—ã–π –®–∏—Ñ—Ä–∞—Ç–æ—Ä PRO</h1>
            <div class="subtitle">AES-256 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞–º–∏</div>
            <div class="security-badge">
                <i class="fas fa-shield-alt"></i>
                <span>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</span>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('encrypt')">
                <i class="fas fa-lock"></i>
                <span>–®–∏—Ñ—Ä–æ–≤–∞—Ç—å</span>
            </button>
            <button class="tab" onclick="switchTab('decrypt')">
                <i class="fas fa-unlock"></i>
                <span>–î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</span>
            </button>
            <button class="tab" onclick="switchTab('files')">
                <i class="fas fa-file"></i>
                <span>–§–∞–π–ª—ã</span>
            </button>
            <button class="tab" onclick="switchTab('storage')">
                <i class="fas fa-folder"></i>
                <span>–•—Ä–∞–Ω–∏–ª–∏—â–µ</span>
            </button>
            <button class="tab" onclick="switchTab('settings')">
                <i class="fas fa-cog"></i>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è -->
        <div id="encrypt" class="tab-content active">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <div>–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –î–∞–Ω–Ω—ã–µ –Ω–∏–∫—É–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è.</div>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-edit"></i> –¢–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</h3>
                <textarea id="plainText" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å..."></textarea>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-signature"></i> –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞</h3>
                <div class="file-output-name">
                    <input type="text" id="outputFileName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)" value="encrypted_data">
                    <select id="fileExtension" class="form-control" style="width: auto; min-width: 120px;">
                        <option value=".enc">.enc</option>
                        <option value=".crypt">.crypt</option>
                        <option value=".aes">.aes</option>
                        <option value=".safe">.safe</option>
                        <option value=".secure">.secure</option>
                        <option value=".locked">.locked</option>
                        <option value=".vault">.vault</option>
                        <option value=".cipher">.cipher</option>
                        <option value="custom">–î—Ä—É–≥–æ–µ...</option>
                    </select>
                </div>
                <div class="custom-extension" id="customExtensionContainer" style="display: none;">
                    <input type="text" id="customExtension" placeholder=".–≤–∞—à–µ_—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ" maxlength="10">
                </div>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-key"></i> –ü–∞—Ä–æ–ª—å</h3>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
                    <div class="password-wrapper">
                        <input type="password" id="encryptPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('encryptPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-strength">
                        <div class="strength-meter" id="passwordStrength"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="encryptPasswordConfirm" class="form-control" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('encryptPasswordConfirm')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="buttons-grid">
                <button class="btn btn-primary" onclick="encryptText()">
                    <i class="fas fa-lock"></i>
                    <span>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
                </button>
                <button class="btn btn-secondary" onclick="clearEncryptForm()">
                    <i class="fas fa-broom"></i>
                    <span>–û—á–∏—Å—Ç–∏—Ç—å</span>
                </button>
            </div>
            
            <div class="result-container" id="encryptResult">
                <h3 class="card-title"><i class="fas fa-file-code"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                <div class="result-box" id="encryptedOutput"></div>
                <div class="buttons-grid" style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="copyResult('encryptedOutput')">
                        <i class="fas fa-copy"></i>
                        <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
                    </button>
                    <button class="btn btn-primary" onclick="saveEncryptedFile()">
                        <i class="fas fa-download"></i>
                        <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è -->
        <div id="decrypt" class="tab-content">
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <div>–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏.</div>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-contract"></i> –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                <textarea id="encryptedText" class="form-control" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ..."></textarea>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-key"></i> –ü–∞—Ä–æ–ª—å –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏</h3>
                <div class="password-wrapper">
                    <input type="password" id="decryptPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    <button type="button" class="toggle-password" onclick="togglePassword('decryptPassword')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="buttons-grid">
                <button class="btn btn-primary" onclick="decryptText()">
                    <i class="fas fa-unlock"></i>
                    <span>–î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</span>
                </button>
                <button class="btn btn-success" onclick="loadFromFile('encryptedText')">
                    <i class="fas fa-folder-open"></i>
                    <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</span>
                </button>
                <button class="btn btn-secondary" onclick="clearDecryptForm()">
                    <i class="fas fa-broom"></i>
                    <span>–û—á–∏—Å—Ç–∏—Ç—å</span>
                </button>
            </div>
            
            <div class="result-container" id="decryptResult">
                <h3 class="card-title"><i class="fas fa-file-alt"></i> –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</h3>
                <div class="result-box" id="decryptedOutput"></div>
                <div class="buttons-grid" style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="copyResult('decryptedOutput')">
                        <i class="fas fa-copy"></i>
                        <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
                    </button>
                    <button class="btn btn-primary" onclick="saveDecryptedFile()">
                        <i class="fas fa-download"></i>
                        <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ -->
        <div id="files" class="tab-content">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <div>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ª—é–±—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏. –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 10 —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</div>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-export"></i> –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤</h3>
                
                <div class="form-group">
                    <label class="form-label">–ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞</label>
                    <div class="file-output-name">
                        <input type="text" id="filesOutputName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞" value="encrypted_files">
                        <select id="filesExtension" class="form-control" style="width: auto; min-width: 120px;">
                            <option value=".enc">.enc</option>
                            <option value=".crypt">.crypt</option>
                            <option value=".aes">.aes</option>
                            <option value=".safe">.safe</option>
                            <option value=".vault">.vault</option>
                        </select>
                    </div>
                </div>
                
                <div class="file-input-wrapper">
                    <input type="file" id="fileToEncrypt" class="form-control" multiple>
                    <label class="file-input-label" for="fileToEncrypt">
                        <i class="fas fa-cloud-upload-alt fa-2x"></i>
                        <div style="margin-top: 10px; font-weight: 600;">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã (–¥–æ 10 —Ñ–∞–π–ª–æ–≤)</div>
                    </label>
                </div>
                
                <div class="file-info" id="encryptFileInfo">
                    <div class="selected-files-list" id="encryptSelectedFiles"></div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
                    <div class="password-wrapper">
                        <input type="password" id="fileEncryptPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('fileEncryptPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="progress-container" id="encryptProgress">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div style="text-align: center; margin-top: 5px; font-size: 0.9rem;" id="encryptProgressText">0%</div>
                </div>
                
                <div class="buttons-grid" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="encryptFiles()">
                        <i class="fas fa-lock"></i>
                        <span>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã</span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearSelectedFiles('encrypt')">
                        <i class="fas fa-trash"></i>
                        <span>–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫</span>
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-file-import"></i> –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</h3>
                
                <div class="file-input-wrapper">
                    <input type="file" id="fileToDecrypt" accept=".enc,.crypt,.aes,.safe,.secure,.locked,.vault,.cipher" class="form-control">
                    <label class="file-input-label" for="fileToDecrypt">
                        <i class="fas fa-cloud-upload-alt fa-2x"></i>
                        <div style="margin-top: 10px; font-weight: 600;">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">–§–∞–π–ª—ã —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</div>
                    </label>
                </div>
                
                <div class="file-info" id="decryptFileInfo"></div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏</label>
                    <div class="password-wrapper">
                        <input type="password" id="fileDecryptPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('fileDecryptPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="progress-container" id="decryptProgress">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div style="text-align: center; margin-top: 5px; font-size: 0.9rem;" id="decryptProgressText">0%</div>
                </div>
                
                <div class="buttons-grid" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="decryptFile()">
                        <i class="fas fa-unlock"></i>
                        <span>–î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –•—Ä–∞–Ω–∏–ª–∏—â–µ -->
        <div id="storage" class="tab-content">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <div>–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤–∞—à–∏—Ö –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</div>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-folder-plus"></i> –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</h3>
                
                <div class="form-group">
                    <label class="form-label">–ò–º—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</label>
                    <input type="text" id="storageName" class="form-control" placeholder="–ú–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ" value="–ó–∞—â–∏—â–µ–Ω–Ω–æ–µ –•—Ä–∞–Ω–∏–ª–∏—â–µ">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É</label>
                    <div class="password-wrapper">
                        <input type="password" id="storagePassword" class="form-control" placeholder="–°–æ–∑–¥–∞–π—Ç–µ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('storagePassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="storagePasswordConfirm" class="form-control" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('storagePasswordConfirm')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="buttons-grid">
                    <button class="btn btn-success" onclick="setupStorage()">
                        <i class="fas fa-check-circle"></i>
                        <span>–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</span>
                    </button>
                    <button class="btn btn-primary" onclick="accessStorage()" id="accessStorageBtn" style="display: none;">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>–û—Ç–∫—Ä—ã—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</span>
                    </button>
                </div>
            </div>
            
            <div class="card" id="storageInfoCard" style="display: none;">
                <h3 class="card-title"><i class="fas fa-folder-open"></i> –¢–µ–∫—É—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</h3>
                
                <div class="folder-info">
                    <div><strong>–ò–º—è:</strong> <span id="currentStorageName"></span></div>
                    <div><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> <span id="storageCreated"></span></div>
                    <div><strong>–§–∞–π–ª–æ–≤:</strong> <span id="storageFileCount">0</span></div>
                    <div class="folder-path" id="virtualPath">/–ó–∞—â–∏—â–µ–Ω–Ω–æ–µ_–•—Ä–∞–Ω–∏–ª–∏—â–µ/</div>
                </div>
                
                <div class="locked-folder">
                    <i class="fas fa-lock"></i>
                    <div>–•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞—â–∏—â–µ–Ω–æ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª–µ–º</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è</div>
                </div>
                
                <div class="buttons-grid" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="addFileToStorage()">
                        <i class="fas fa-plus"></i>
                        <span>–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª</span>
                    </button>
                    <button class="btn btn-success" onclick="browseStorage()">
                        <i class="fas fa-search"></i>
                        <span>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª—ã</span>
                    </button>
                    <button class="btn btn-danger" onclick="clearStorage()">
                        <i class="fas fa-trash"></i>
                        <span>–û—á–∏—Å—Ç–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h3 class="card-title"><i class="fas fa-user-shield"></i> –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                
                <div class="settings-group">
                    <div class="form-group">
                        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π PBKDF2</label>
                        <select id="iterations" class="form-control">
                            <option value="50000">50,000 (–±—ã—Å—Ç—Ä–æ)</option>
                            <option value="100000" selected>100,000 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                            <option value="300000">300,000 (–≤—ã—Å–æ–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)</option>
                            <option value="600000">600,000 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è)</option>
                        </select>
                        <div style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;">
                            –ë–æ–ª—å—à–µ –∏—Ç–µ—Ä–∞—Ü–∏–π = –ª—É—á—à–µ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ —Ä–∞–±–æ—Ç–∞
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="autoClear" checked>
                            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—Ç—å —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="hidePasswords" checked>
                            –°–∫—Ä—ã–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        </label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4 class="settings-title"><i class="fas fa-file-export"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π–ª–æ–≤</h4>
                    
                    <div class="form-group">
                        <label class="form-label">–†–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</label>
                        <div class="file-extension-group">
                            <label class="extension-option">
                                <input type="checkbox" id="extEnc" checked> .enc
                            </label>
                            <label class="extension-option">
                                <input type="checkbox" id="extCrypt"> .crypt
                            </label>
                            <label class="extension-option">
                                <input type="checkbox" id="extAes"> .aes
                            </label>
                            <label class="extension-option">
                                <input type="checkbox" id="extSafe"> .safe
                            </label>
                            <label class="extension-option">
                                <input type="checkbox" id="extSecure"> .secure
                            </label>
                            <label class="extension-option">
                                <input type="checkbox" id="extLocked"> .locked
                            </label>
                            <label class="extension-option">
                                <input type="checkbox" id="extVault"> .vault
                            </label>
                            <label class="extension-option">
                                <input type="checkbox" id="extCipher"> .cipher
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                        <input type="text" id="defaultFolderName" class="form-control" placeholder="Encrypted_Files" value="Encrypted_Files">
                        <div style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;">
                            –ò–º—è –ø–∞–ø–∫–∏, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3 class="card-title"><i class="fas fa-info-circle"></i> –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</h3>
                
                <div style="line-height: 1.8;">
                    <p><strong>–í–µ—Ä—Å–∏—è:</strong> 3.0.0 PRO</p>
                    <p><strong>–ê–ª–≥–æ—Ä–∏—Ç–º—ã:</strong> AES-256-GCM, PBKDF2, SHA-256</p>
                    <p><strong>–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:</strong> –ë–∏–Ω–∞—Ä–Ω—ã–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º</p>
                    <p><strong>–õ–∏—Ü–µ–Ω–∑–∏—è:</strong> MIT Open Source</p>
                    <p><strong>–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</strong></p>
                    <ul style="padding-left: 20px; margin-top: 10px;">
                        <li>–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
                        <li>–í—ã–±–æ—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞</li>
                        <li>–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</li>
                        <li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ —Ñ–∞–π–ª–æ–≤</li>
                        <li>–£–ª—É—á—à–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</li>
                    </ul>
                </div>
            </div>
            
            <div class="buttons-grid">
                <button class="btn btn-success" onclick="exportSettings()">
                    <i class="fas fa-save"></i>
                    <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </button>
                <button class="btn btn-warning" onclick="resetSettings()">
                    <i class="fas fa-redo"></i>
                    <span>–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </button>
                <button class="btn btn-primary" onclick="saveOffline()">
                    <i class="fas fa-download"></i>
                    <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ñ—Ñ–ª–∞–π–Ω</span>
                </button>
            </div>
        </div>
        
        <!-- –ü–æ–¥–≤–∞–ª -->
        <div class="footer">
            <div>üîê –ú–æ–±–∏–ª—å–Ω—ã–π –®–∏—Ñ—Ä–∞—Ç–æ—Ä PRO v3.0</div>
            <div style="font-size: 0.8rem; margin-top: 5px; color: #adb5bd;">
                –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ ‚Ä¢ –ù–∏–∫–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–µ—Ç—å
            </div>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä -->
    <div class="status-bar" id="statusBar">
        <i class="fas fa-check-circle"></i>
        <span id="statusText">–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</span>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø–∞–ø–∫–∏ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ) -->
    <div class="modal" id="folderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0;"><i class="fas fa-folder"></i> –í—ã–±–µ—Ä–∏—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É</h3>
                <button class="close-modal" onclick="closeModal('folderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="virtualFolderList"></div>
                <div class="form-group" style="margin-top: 15px;">
                    <input type="text" id="newFolderName" class="form-control" placeholder="–ù–æ–≤–∞—è –ø–∞–ø–∫–∞">
                    <button class="btn btn-primary" style="margin-top: 10px; width: 100%;" onclick="createVirtualFolder()">
                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–∞–ø–∫—É
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let iterations = 100000;
        let autoClear = true;
        let hidePasswords = true;
        let selectedFiles = [];
        const MAX_FILES = 10;
        let storagePassword = null;
        let isStorageSetup = false;
        let virtualStorage = {
            name: '',
            created: '',
            files: [],
            folders: []
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            setupEventListeners();
            checkCryptoSupport();
            checkStorageStatus();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
            document.getElementById('fileExtension').addEventListener('change', function() {
                const customContainer = document.getElementById('customExtensionContainer');
                if (this.value === 'custom') {
                    customContainer.style.display = 'flex';
                } else {
                    customContainer.style.display = 'none';
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            setTimeout(() => {
                if (!localStorage.getItem('cryptoAppFirstRun')) {
                    showStatus('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–æ–±–∏–ª—å–Ω—ã–π –®–∏—Ñ—Ä–∞—Ç–æ—Ä PRO! –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.', 'info');
                    localStorage.setItem('cryptoAppFirstRun', 'true');
                }
            }, 1000);
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Web Crypto API
        function checkCryptoSupport() {
            if (!window.crypto || !window.crypto.subtle) {
                showStatus('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Web Crypto API. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä.', 'danger');
                return false;
            }
            return true;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        function checkStorageStatus() {
            const savedStorage = localStorage.getItem('cryptoAppStorage');
            if (savedStorage) {
                try {
                    const storageData = JSON.parse(savedStorage);
                    if (storageData.name) {
                        isStorageSetup = true;
                        virtualStorage = storageData;
                        document.getElementById('accessStorageBtn').style.display = 'block';
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:', e);
                }
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function loadSettings() {
            const saved = localStorage.getItem('cryptoAppSettings');
            if (saved) {
                try {
                    const settings = JSON.parse(saved);
                    iterations = settings.iterations || 100000;
                    autoClear = settings.autoClear !== false;
                    hidePasswords = settings.hidePasswords !== false;
                    
                    document.getElementById('iterations').value = iterations;
                    document.getElementById('autoClear').checked = autoClear;
                    document.getElementById('hidePasswords').checked = hidePasswords;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
            const savedExtensions = localStorage.getItem('cryptoAppExtensions');
            if (savedExtensions) {
                try {
                    const extensions = JSON.parse(savedExtensions);
                    document.getElementById('extEnc').checked = extensions.enc !== false;
                    document.getElementById('extCrypt').checked = extensions.crypt || false;
                    document.getElementById('extAes').checked = extensions.aes || false;
                    document.getElementById('extSafe').checked = extensions.safe || false;
                    document.getElementById('extSecure').checked = extensions.secure || false;
                    document.getElementById('extLocked').checked = extensions.locked || false;
                    document.getElementById('extVault').checked = extensions.vault || false;
                    document.getElementById('extCipher').checked = extensions.cipher || false;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:', e);
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–º—è –ø–∞–ø–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const defaultFolder = localStorage.getItem('cryptoAppDefaultFolder');
            if (defaultFolder) {
                document.getElementById('defaultFolderName').value = defaultFolder;
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function saveSettings() {
            const settings = {
                iterations: parseInt(document.getElementById('iterations').value),
                autoClear: document.getElementById('autoClear').checked,
                hidePasswords: document.getElementById('hidePasswords').checked
            };
            localStorage.setItem('cryptoAppSettings', JSON.stringify(settings));
            
            iterations = settings.iterations;
            autoClear = settings.autoClear;
            hidePasswords = settings.hidePasswords;
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function exportSettings() {
            saveSettings();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
            const extensions = {
                enc: document.getElementById('extEnc').checked,
                crypt: document.getElementById('extCrypt').checked,
                aes: document.getElementById('extAes').checked,
                safe: document.getElementById('extSafe').checked,
                secure: document.getElementById('extSecure').checked,
                locked: document.getElementById('extLocked').checked,
                vault: document.getElementById('extVault').checked,
                cipher: document.getElementById('extCipher').checked
            };
            
            localStorage.setItem('cryptoAppExtensions', JSON.stringify(extensions));
            localStorage.setItem('cryptoAppDefaultFolder', document.getElementById('defaultFolderName').value);
            
            showStatus('–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        }
        
        // –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function resetSettings() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?')) {
                localStorage.removeItem('cryptoAppSettings');
                localStorage.removeItem('cryptoAppExtensions');
                localStorage.removeItem('cryptoAppDefaultFolder');
                location.reload();
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ñ—Ñ–ª–∞–π–Ω
        function saveOffline() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mobile_encryptor_pro.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!', 'success');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName).classList.add('active');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–≤–µ—Ä—Ö
            window.scrollTo(0, 0);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(message, type = 'success') {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            const icon = statusBar.querySelector('i');
            
            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–≤–µ—Ç –∏ –∏–∫–æ–Ω–∫—É
            statusBar.style.background = getStatusColor(type);
            icon.className = getStatusIcon(type);
            statusText.textContent = message;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å
            statusBar.style.display = 'flex';
            
            // –°–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                statusBar.style.display = 'none';
            }, 3000);
        }
        
        function getStatusColor(type) {
            switch(type) {
                case 'success': return '#28a745';
                case 'error': return '#dc3545';
                case 'warning': return '#ffc107';
                case 'info': return '#17a2b8';
                default: return '#6c757d';
            }
        }
        
        function getStatusIcon(type) {
            switch(type) {
                case 'success': return 'fas fa-check-circle';
                case 'error': return 'fas fa-exclamation-circle';
                case 'warning': return 'fas fa-exclamation-triangle';
                case 'info': return 'fas fa-info-circle';
                default: return 'fas fa-info-circle';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è
        function checkPasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 8) strength += 1;
            if (password.length >= 12) strength += 1;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 1;
            if (/\d/.test(password)) strength += 1;
            if (/[^A-Za-z0-9]/.test(password)) strength += 1;
            
            return Math.min(strength, 5);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è
        function updatePasswordStrength() {
            const password = document.getElementById('encryptPassword').value;
            const strength = checkPasswordStrength(password);
            const meter = document.getElementById('passwordStrength');
            
            let color, width;
            switch(strength) {
                case 0: width = '0%'; color = '#e9ecef'; break;
                case 1: width = '20%'; color = '#dc3545'; break;
                case 2: width = '40%'; color = '#fd7e14'; break;
                case 3: width = '60%'; color = '#ffc107'; break;
                case 4: width = '80%'; color = '#28a745'; break;
                case 5: width = '100%'; color = '#20c997'; break;
            }
            
            meter.style.width = width;
            meter.style.background = color;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
        async function deriveKey(password, salt) {
            const encoder = new TextEncoder();
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey']
            );
            
            return await crypto.subtle.deriveKey(
                {
                    name: 'PBKDF2',
                    salt: salt,
                    iterations: iterations,
                    hash: 'SHA-256'
                },
                keyMaterial,
                { name: 'AES-GCM', length: 256 },
                false,
                ['encrypt', 'decrypt']
            );
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
        function getFileExtension() {
            const select = document.getElementById('fileExtension');
            const selectedValue = select.value;
            
            if (selectedValue === 'custom') {
                const customExt = document.getElementById('customExtension').value.trim();
                return customExt.startsWith('.') ? customExt : '.' + customExt;
            }
            
            return selectedValue;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        function getOutputFileName() {
            let name = document.getElementById('outputFileName').value.trim();
            if (!name) name = 'encrypted_data';
            
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
            name = name.replace(/\.[^/.]+$/, '');
            
            return name + getFileExtension();
        }
        
        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        async function encryptText() {
            try {
                const plainText = document.getElementById('plainText').value.trim();
                const password = document.getElementById('encryptPassword').value;
                const passwordConfirm = document.getElementById('encryptPasswordConfirm').value;
                const outputFileName = getOutputFileName();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∏
                if (!plainText) {
                    showStatus('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                    return;
                }
                
                if (!password || password.length < 6) {
                    showStatus('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤', 'warning');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    showStatus('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                    return;
                }
                
                if (!checkCryptoSupport()) return;
                
                showStatus('–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ...', 'info');
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                const salt = crypto.getRandomValues(new Uint8Array(16));
                const iv = crypto.getRandomValues(new Uint8Array(12));
                
                // –í—ã–≤–æ–¥ –∫–ª—é—á–∞
                const key = await deriveKey(password, salt);
                
                // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
                const encoder = new TextEncoder();
                const encrypted = await crypto.subtle.encrypt(
                    {
                        name: 'AES-GCM',
                        iv: iv
                    },
                    key,
                    encoder.encode(plainText)
                );
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
                const version = new Uint8Array([2]); // –í–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
                const saltLength = new Uint8Array([salt.length]);
                const ivLength = new Uint8Array([iv.length]);
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –≤ –æ–¥–∏–Ω ArrayBuffer
                const totalLength = version.length + saltLength.length + salt.length + 
                                  ivLength.length + iv.length + encrypted.byteLength;
                const resultBuffer = new Uint8Array(totalLength);
                
                let offset = 0;
                resultBuffer.set(version, offset); offset += version.length;
                resultBuffer.set(saltLength, offset); offset += saltLength.length;
                resultBuffer.set(salt, offset); offset += salt.length;
                resultBuffer.set(ivLength, offset); offset += ivLength.length;
                resultBuffer.set(iv, offset); offset += iv.length;
                resultBuffer.set(new Uint8Array(encrypted), offset);
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Base64 –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const base64Data = arrayBufferToBase64(resultBuffer.buffer);
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                document.getElementById('encryptedOutput').textContent = base64Data;
                document.getElementById('encryptResult').style.display = 'block';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
                setTimeout(() => {
                    saveEncryptedFile();
                }, 500);
                
                showStatus('–¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω!', 'success');
                
                if (autoClear) {
                    setTimeout(() => clearEncryptForm(), 5000);
                }
                
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        function saveEncryptedFile() {
            const base64Data = document.getElementById('encryptedOutput').textContent;
            if (!base64Data) {
                showStatus('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'warning');
                return;
            }
            
            const outputFileName = getOutputFileName();
            const binaryData = base64ToArrayBuffer(base64Data);
            const blob = new Blob([binaryData], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = outputFileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus(`–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ ${outputFileName}`, 'success');
        }
        
        // –ü–∞—Ä—Å–∏–Ω–≥ ENC —Ñ–æ—Ä–º–∞—Ç–∞ (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        function parseEncFormat(encText) {
            try {
                const lines = encText.split('\n');
                const result = {};
                let inHeader = true;
                let ciphertextLines = [];
                
                for (let line of lines) {
                    line = line.trim();
                    
                    if (line === '-----BEGIN ENCRYPTED DATA-----') {
                        continue;
                    }
                    
                    if (line === '-----END ENCRYPTED DATA-----') {
                        break;
                    }
                    
                    if (inHeader) {
                        if (line === '') {
                            inHeader = false;
                            continue;
                        }
                        
                        const colonIndex = line.indexOf(':');
                        if (colonIndex !== -1) {
                            const key = line.substring(0, colonIndex).trim();
                            const value = line.substring(colonIndex + 1).trim();
                            result[key.toLowerCase().replace('-', '')] = value;
                        }
                    } else {
                        if (line) {
                            ciphertextLines.push(line);
                        }
                    }
                }
                
                if (ciphertextLines.length > 0) {
                    result.ciphertext = ciphertextLines.join('');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
                if (!result.ciphertext) {
                    return null;
                }
                
                return {
                    salt: base64ToArrayBuffer(result.salt),
                    iv: base64ToArrayBuffer(result.iv),
                    ciphertext: base64ToArrayBuffer(result.ciphertext)
                };
            } catch (error) {
                return null;
            }
        }
        
        // –ü–∞—Ä—Å–∏–Ω–≥ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
        function parseSimpleEncFormat(base64Data) {
            try {
                const buffer = base64ToArrayBuffer(base64Data);
                const view = new DataView(buffer);
                
                let offset = 0;
                const version = view.getUint8(offset); offset += 1;
                
                if (version !== 2) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞');
                }
                
                const saltLength = view.getUint8(offset); offset += 1;
                const salt = buffer.slice(offset, offset + saltLength); offset += saltLength;
                
                const ivLength = view.getUint8(offset); offset += 1;
                const iv = buffer.slice(offset, offset + ivLength); offset += ivLength;
                
                const ciphertext = buffer.slice(offset);
                
                return {
                    version: version,
                    salt: salt,
                    iv: iv,
                    ciphertext: ciphertext
                };
            } catch (error) {
                return null;
            }
        }
        
        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        async function decryptText() {
            try {
                let encryptedText = document.getElementById('encryptedText').value.trim();
                const password = document.getElementById('decryptPassword').value;
                
                if (!encryptedText || !password) {
                    showStatus('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–∞—Ä–æ–ª—å', 'warning');
                    return;
                }
                
                if (!checkCryptoSupport()) return;
                
                showStatus('–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ...', 'info');
                
                // –£–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ (–¥–ª—è Base64)
                encryptedText = encryptedText.replace(/\s/g, '');
                
                let encryptedPackage;
                
                // –ü—Ä–æ–±—É–µ–º –Ω–æ–≤—ã–π —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                encryptedPackage = parseSimpleEncFormat(encryptedText);
                
                // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø—Ä–æ–±—É–µ–º —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
                if (!encryptedPackage && encryptedText.includes('-----BEGIN ENCRYPTED DATA-----')) {
                    encryptedPackage = parseEncFormat(encryptedText);
                }
                
                if (!encryptedPackage) {
                    showStatus('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', 'error');
                    return;
                }
                
                // –í—ã–≤–æ–¥ –∫–ª—é—á–∞
                const key = await deriveKey(password, encryptedPackage.salt);
                
                // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
                const decrypted = await crypto.subtle.decrypt(
                    {
                        name: 'AES-GCM',
                        iv: encryptedPackage.iv
                    },
                    key,
                    encryptedPackage.ciphertext
                );
                
                // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                const decoder = new TextDecoder();
                const decryptedText = decoder.decode(decrypted);
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                document.getElementById('decryptedOutput').textContent = decryptedText;
                document.getElementById('decryptResult').style.display = 'block';
                
                showStatus('–¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω!', 'success');
                
                if (autoClear) {
                    setTimeout(() => clearDecryptForm(), 5000);
                }
                
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'error');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        function saveDecryptedFile() {
            const text = document.getElementById('decryptedOutput').textContent;
            if (!text) {
                showStatus('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'warning');
                return;
            }
            
            const fileName = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞:', 'decrypted_text.txt') || 'decrypted_text.txt';
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus(`–¢–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ ${fileName}`, 'success');
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function copyResult(elementId) {
            const text = document.getElementById(elementId).textContent;
            if (!text) {
                showStatus('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showStatus('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            }).catch(err => {
                showStatus('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message, 'error');
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞
        function loadFromFile(elementId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.enc,.crypt,.aes,.safe,.secure,.locked,.vault,.cipher,.txt,.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    document.getElementById(elementId).value = e.target.result;
                    showStatus(`–§–∞–π–ª "${file.name}" –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                };
                
                reader.onerror = function() {
                    showStatus('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        function clearEncryptForm() {
            document.getElementById('plainText').value = '';
            document.getElementById('encryptPassword').value = '';
            document.getElementById('encryptPasswordConfirm').value = '';
            document.getElementById('encryptResult').style.display = 'none';
            document.getElementById('passwordStrength').style.width = '0%';
            showStatus('–§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞', 'info');
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        function clearDecryptForm() {
            document.getElementById('encryptedText').value = '';
            document.getElementById('decryptPassword').value = '';
            document.getElementById('decryptResult').style.display = 'none';
            showStatus('–§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞', 'info');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ArrayBuffer –∏ Base64
        function arrayBufferToBase64(buffer) {
            const bytes = new Uint8Array(buffer);
            let binary = '';
            for (let i = 0; i < bytes.byteLength; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }
        
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const bytes = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress(containerId, percent, text) {
            const container = document.getElementById(containerId);
            const bar = container.querySelector('.progress-fill');
            const textEl = container.querySelector('#encryptProgressText, #decryptProgressText');
            
            if (bar) bar.style.width = `${percent}%`;
            if (textEl) textEl.textContent = text || `${percent}%`;
        }
        
        // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ ArrayBuffer
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
                reader.readAsArrayBuffer(file);
            });
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        function updateSelectedFilesList() {
            const container = document.getElementById('encryptSelectedFiles');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">–§–∞–π–ª—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</p>';
                document.getElementById('encryptFileInfo').style.display = 'block';
                return;
            }
            
            let totalSize = 0;
            selectedFiles.forEach((file, index) => {
                totalSize += file.size;
                
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-item-info">
                        <div class="file-item-name">${file.name}</div>
                        <div class="file-item-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="remove-file-btn" onclick="removeFile(${index})" title="–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(fileItem);
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            const totalInfo = document.createElement('div');
            totalInfo.style.marginTop = '10px';
            totalInfo.style.fontSize = '0.9rem';
            totalInfo.innerHTML = `
                <strong>–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:</strong> ${selectedFiles.length} / ${MAX_FILES}<br>
                <strong>–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:</strong> ${formatFileSize(totalSize)}
            `;
            container.appendChild(totalInfo);
            
            document.getElementById('encryptFileInfo').style.display = 'block';
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateSelectedFilesList();
            showStatus(`–§–∞–π–ª —É–¥–∞–ª–µ–Ω –∏–∑ —Å–ø–∏—Å–∫–∞`, 'info');
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
        function clearSelectedFiles(type) {
            if (type === 'encrypt') {
                selectedFiles = [];
                document.getElementById('fileToEncrypt').value = '';
                updateSelectedFilesList();
                showStatus('–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –æ—á–∏—â–µ–Ω', 'info');
            }
        }
        
        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
        async function encryptFiles() {
            if (selectedFiles.length === 0) {
                showStatus('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                return;
            }
            
            const password = document.getElementById('fileEncryptPassword').value;
            
            if (!password || password.length < 6) {
                showStatus('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤', 'warning');
                return;
            }
            
            if (!checkCryptoSupport()) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –∞—Ä—Ö–∏–≤–∞
            let archiveName = document.getElementById('filesOutputName').value.trim();
            if (!archiveName) archiveName = 'encrypted_files';
            
            const extension = document.getElementById('filesExtension').value;
            archiveName = archiveName.replace(/\.[^/.]+$/, '') + extension;
            
            document.getElementById('encryptProgress').style.display = 'block';
            updateProgress('encryptProgress', 0, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...');
            
            try {
                const results = [];
                
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const progress = Math.round((i / selectedFiles.length) * 100);
                    updateProgress('encryptProgress', progress, `–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ${i + 1} –∏–∑ ${selectedFiles.length}: ${file.name}`);
                    
                    const fileData = await readFileAsArrayBuffer(file);
                    const salt = crypto.getRandomValues(new Uint8Array(16));
                    const iv = crypto.getRandomValues(new Uint8Array(12));
                    
                    const key = await deriveKey(password, salt);
                    
                    const encrypted = await crypto.subtle.encrypt(
                        {
                            name: 'AES-GCM',
                            iv: iv
                        },
                        key,
                        fileData
                    );
                    
                    // –°–æ–∑–¥–∞–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
                    const version = new Uint8Array([2]);
                    const saltLength = new Uint8Array([salt.length]);
                    const ivLength = new Uint8Array([iv.length]);
                    
                    const totalLength = version.length + saltLength.length + salt.length + 
                                      ivLength.length + iv.length + encrypted.byteLength;
                    const resultBuffer = new Uint8Array(totalLength);
                    
                    let offset = 0;
                    resultBuffer.set(version, offset); offset += version.length;
                    resultBuffer.set(saltLength, offset); offset += saltLength.length;
                    resultBuffer.set(salt, offset); offset += salt.length;
                    resultBuffer.set(ivLength, offset); offset += ivLength.length;
                    resultBuffer.set(iv, offset); offset += iv.length;
                    resultBuffer.set(new Uint8Array(encrypted), offset);
                    
                    results.push({
                        filename: file.name,
                        filetype: file.type,
                        filesize: file.size,
                        data: arrayBufferToBase64(resultBuffer.buffer)
                    });
                }
                
                updateProgress('encryptProgress', 90, '–°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞...');
                
                // –°–æ–∑–¥–∞–µ–º JSON –∞—Ä—Ö–∏–≤ —Å —Ñ–∞–π–ª–∞–º–∏
                const archive = {
                    version: '3.0',
                    algorithm: 'AES-256-GCM',
                    files: results,
                    timestamp: new Date().toISOString(),
                    fileCount: results.length
                };
                
                const archiveText = JSON.stringify(archive, null, 2);
                const blob = new Blob([archiveText], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
                const a = document.createElement('a');
                a.href = url;
                a.download = archiveName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                updateProgress('encryptProgress', 100, '–ì–æ—Ç–æ–≤–æ!');
                showStatus(`${selectedFiles.length} —Ñ–∞–π–ª–æ–≤ —É—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã!`, 'success');
                
                setTimeout(() => {
                    document.getElementById('encryptProgress').style.display = 'none';
                    if (autoClear) {
                        clearSelectedFiles('encrypt');
                        document.getElementById('fileEncryptPassword').value = '';
                    }
                }, 2000);
                
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
                document.getElementById('encryptProgress').style.display = 'none';
            }
        }
        
        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        async function decryptFile() {
            const fileInput = document.getElementById('fileToDecrypt');
            const password = document.getElementById('fileDecryptPassword').value;
            
            if (!fileInput.files.length) {
                showStatus('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                return;
            }
            
            if (!password) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏', 'warning');
                return;
            }
            
            if (!checkCryptoSupport()) return;
            
            const file = fileInput.files[0];
            
            document.getElementById('decryptProgress').style.display = 'block';
            updateProgress('decryptProgress', 0, '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...');
            
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    updateProgress('decryptProgress', 30, '–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞...');
                    
                    const fileContent = e.target.result;
                    const text = new TextDecoder().decode(fileContent);
                    let encryptedData;
                    
                    // –ü—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON –∞—Ä—Ö–∏–≤
                    try {
                        const archive = JSON.parse(text);
                        if (archive.files && Array.isArray(archive.files)) {
                            // –≠—Ç–æ –∞—Ä—Ö–∏–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
                            for (let i = 0; i < archive.files.length; i++) {
                                const fileData = archive.files[i];
                                const progress = 30 + Math.round((i / archive.files.length) * 60);
                                updateProgress('decryptProgress', progress, `–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ${i + 1} –∏–∑ ${archive.files.length}`);
                                
                                const filePackage = parseSimpleEncFormat(fileData.data);
                                if (!filePackage) {
                                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –≤ –∞—Ä—Ö–∏–≤–µ');
                                }
                                
                                const key = await deriveKey(password, filePackage.salt);
                                
                                const decrypted = await crypto.subtle.decrypt(
                                    {
                                        name: 'AES-GCM',
                                        iv: filePackage.iv
                                    },
                                    key,
                                    filePackage.ciphertext
                                );
                                
                                let filename = fileData.filename;
                                if (archive.files.length > 1) {
                                    const suggestedName = filename.startsWith('decrypted_') ? 
                                        filename : `decrypted_${filename}`;
                                    const newName = prompt(`–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è —Ñ–∞–π–ª–∞ "${filename}":`, suggestedName);
                                    if (newName) filename = newName;
                                    else filename = suggestedName;
                                } else {
                                    const suggestedName = filename.startsWith('decrypted_') ? 
                                        filename : `decrypted_${filename}`;
                                    const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:', suggestedName);
                                    if (newName) filename = newName;
                                    else filename = suggestedName;
                                }
                                
                                const blob = new Blob([decrypted], { 
                                    type: fileData.filetype || 'application/octet-stream' 
                                });
                                const url = URL.createObjectURL(blob);
                                
                                const a = document.createElement('a');
                                a.href = url;
                                a.download = filename;
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                URL.revokeObjectURL(url);
                            }
                            
                            updateProgress('decryptProgress', 100, '–ì–æ—Ç–æ–≤–æ!');
                            showStatus(`${archive.files.length} —Ñ–∞–π–ª–æ–≤ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã!`, 'success');
                        } else {
                            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞—Ä—Ö–∏–≤–∞');
                        }
                    } catch (jsonError) {
                        // –ù–µ JSON, –ø—Ä–æ–±—É–µ–º –∫–∞–∫ –æ–¥–∏–Ω–æ—á–Ω—ã–π —Ñ–∞–π–ª
                        updateProgress('decryptProgress', 50, '–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞...');
                        
                        const filePackage = parseSimpleEncFormat(text) || parseEncFormat(text);
                        if (!filePackage) {
                            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }
                        
                        const key = await deriveKey(password, filePackage.salt);
                        
                        updateProgress('decryptProgress', 75, '–û–±—Ä–∞–±–æ—Ç–∫–∞...');
                        
                        const decrypted = await crypto.subtle.decrypt(
                            {
                                name: 'AES-GCM',
                                iv: filePackage.iv
                            },
                            key,
                            filePackage.ciphertext
                        );
                        
                        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
                        let filename = file.name.replace(/\.[^/.]+$/, '');
                        const suggestedName = filename.startsWith('decrypted_') ? 
                            filename : `decrypted_${filename}`;
                        const newFilename = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:', suggestedName) || suggestedName;
                        
                        const blob = new Blob([decrypted], { 
                            type: file.type || 'application/octet-stream' 
                        });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = newFilename;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        updateProgress('decryptProgress', 100, '–ì–æ—Ç–æ–≤–æ!');
                        showStatus('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω!', 'success');
                    }
                    
                    setTimeout(() => {
                        document.getElementById('decryptProgress').style.display = 'none';
                    }, 2000);
                    
                } catch (error) {
                    showStatus('–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª', 'error');
                    document.getElementById('decryptProgress').style.display = 'none';
                }
            };
            
            reader.onerror = function() {
                showStatus('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                document.getElementById('decryptProgress').style.display = 'none';
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        function setupStorage() {
            const name = document.getElementById('storageName').value.trim();
            const password = document.getElementById('storagePassword').value;
            const confirmPassword = document.getElementById('storagePasswordConfirm').value;
            
            if (!name) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞', 'warning');
                return;
            }
            
            if (!password || password.length < 8) {
                showStatus('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤', 'warning');
                return;
            }
            
            if (password !== confirmPassword) {
                showStatus('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ö—ç—à –ø–∞—Ä–æ–ª—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
            storagePassword = btoa(encodeURIComponent(password));
            
            virtualStorage = {
                name: name,
                created: new Date().toISOString(),
                files: [],
                folders: ['/–û—Å–Ω–æ–≤–Ω—ã–µ_—Ñ–∞–π–ª—ã/', '/–ê—Ä—Ö–∏–≤—ã/', '/–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ/'],
                passwordHash: storagePassword
            };
            
            localStorage.setItem('cryptoAppStorage', JSON.stringify(virtualStorage));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('currentStorageName').textContent = name;
            document.getElementById('storageCreated').textContent = new Date().toLocaleString();
            document.getElementById('storageFileCount').textContent = '0';
            document.getElementById('virtualPath').textContent = `/${name.replace(/\s+/g, '_')}/`;
            document.getElementById('storageInfoCard').style.display = 'block';
            
            isStorageSetup = true;
            document.getElementById('accessStorageBtn').style.display = 'block';
            showStatus('–•—Ä–∞–Ω–∏–ª–∏—â–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ –∏ –∑–∞—â–∏—â–µ–Ω–æ –ø–∞—Ä–æ–ª–µ–º!', 'success');
        }
        
        // –î–æ—Å—Ç—É–ø –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É
        function accessStorage() {
            const password = prompt('–í–≤–µ–¥–∏—Ç–µ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É:');
            if (!password) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è)
            const enteredHash = btoa(encodeURIComponent(password));
            if (enteredHash === virtualStorage.passwordHash) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                document.getElementById('currentStorageName').textContent = virtualStorage.name;
                document.getElementById('storageCreated').textContent = new Date(virtualStorage.created).toLocaleString();
                document.getElementById('storageFileCount').textContent = virtualStorage.files.length;
                document.getElementById('virtualPath').textContent = `/${virtualStorage.name.replace(/\s+/g, '_')}/`;
                document.getElementById('storageInfoCard').style.display = 'block';
                
                showStatus('–î–æ—Å—Ç—É–ø –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É —Ä–∞–∑—Ä–µ—à–µ–Ω', 'success');
            } else {
                showStatus('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
            }
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        function browseStorage() {
            if (!isStorageSetup) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ', 'warning');
                return;
            }
            
            const password = prompt('–í–≤–µ–¥–∏—Ç–µ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤:');
            if (!password) return;
            
            const enteredHash = btoa(encodeURIComponent(password));
            if (enteredHash !== virtualStorage.passwordHash) {
                showStatus('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            let fileList = '–§–∞–π–ª—ã –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:\n\n';
            if (virtualStorage.files.length === 0) {
                fileList += '–•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—É—Å—Ç–æ–µ\n';
            } else {
                virtualStorage.files.forEach((file, index) => {
                    fileList += `${index + 1}. ${file.name} (${formatFileSize(file.size)})\n`;
                });
            }
            
            fileList += `\n–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: ${virtualStorage.files.length}`;
            alert(fileList);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        function addFileToStorage() {
            if (!isStorageSetup) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ', 'warning');
                return;
            }
            
            const password = prompt('–í–≤–µ–¥–∏—Ç–µ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞:');
            if (!password) return;
            
            const enteredHash = btoa(encodeURIComponent(password));
            if (enteredHash !== virtualStorage.passwordHash) {
                showStatus('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            const input = document.createElement('input');
            input.type = 'file';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                    const fileData = {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        lastModified: file.lastModified,
                        data: e.target.result,
                        added: new Date().toISOString()
                    };
                    
                    virtualStorage.files.push(fileData);
                    localStorage.setItem('cryptoAppStorage', JSON.stringify(virtualStorage));
                    
                    document.getElementById('storageFileCount').textContent = virtualStorage.files.length;
                    showStatus(`–§–∞–π–ª "${file.name}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ`, 'success');
                };
                
                reader.onerror = function() {
                    showStatus('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                };
                
                reader.readAsDataURL(file);
            };
            
            input.click();
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        function clearStorage() {
            if (!isStorageSetup) return;
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ? –í—Å–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                virtualStorage.files = [];
                localStorage.setItem('cryptoAppStorage', JSON.stringify(virtualStorage));
                
                document.getElementById('storageFileCount').textContent = '0';
                showStatus('–•—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–∏—â–µ–Ω–æ', 'success');
            }
        }
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–∏
        function createVirtualFolder() {
            const folderName = document.getElementById('newFolderName').value.trim();
            if (!folderName) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–∞–ø–∫–∏', 'warning');
                return;
            }
            
            if (virtualStorage.folders.includes('/' + folderName + '/')) {
                showStatus('–ü–∞–ø–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'warning');
                return;
            }
            
            virtualStorage.folders.push('/' + folderName + '/');
            localStorage.setItem('cryptoAppStorage', JSON.stringify(virtualStorage));
            
            showStatus(`–ü–∞–ø–∫–∞ "${folderName}" —Å–æ–∑–¥–∞–Ω–∞`, 'success');
            document.getElementById('newFolderName').value = '';
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è
            document.getElementById('encryptPassword').addEventListener('input', updatePasswordStrength);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('fileToEncrypt').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                
                if (files.length > MAX_FILES) {
                    showStatus(`–ú–∞–∫—Å–∏–º—É–º ${MAX_FILES} —Ñ–∞–π–ª–æ–≤`, 'warning');
                    this.value = '';
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                selectedFiles = files;
                updateSelectedFilesList();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ label
                const label = this.nextElementSibling;
                const labelText = label.querySelector('div:nth-child(2)');
                if (files.length === 1) {
                    labelText.textContent = `–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${files[0].name}`;
                } else {
                    labelText.textContent = `–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: ${files.length}`;
                }
                
                showStatus(`–í—ã–±—Ä–∞–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤`, 'success');
            });
            
            // Drag and drop –¥–ª—è —Ñ–∞–π–ª–æ–≤
            const dropZones = document.querySelectorAll('.file-input-label');
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', e => {
                    e.preventDefault();
                    zone.style.borderColor = '#4361ee';
                    zone.style.background = 'rgba(67, 97, 238, 0.1)';
                });
                
                zone.addEventListener('dragleave', e => {
                    e.preventDefault();
                    zone.style.borderColor = '';
                    zone.style.background = '';
                });
                
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.style.borderColor = '';
                    zone.style.background = '';
                    
                    const files = Array.from(e.dataTransfer.files);
                    
                    // –î–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
                    if (zone.htmlFor === 'fileToEncrypt' || zone.previousElementSibling.id === 'fileToEncrypt') {
                        if (files.length > MAX_FILES) {
                            showStatus(`–ú–∞–∫—Å–∏–º—É–º ${MAX_FILES} —Ñ–∞–π–ª–æ–≤`, 'warning');
                            return;
                        }
                        
                        selectedFiles = files;
                        updateSelectedFilesList();
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º input
                        const input = zone.previousElementSibling;
                        const dataTransfer = new DataTransfer();
                        files.forEach(file => dataTransfer.items.add(file));
                        input.files = dataTransfer.files;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç label
                        const labelText = zone.querySelector('div:nth-child(2)');
                        if (files.length === 1) {
                            labelText.textContent = `–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${files[0].name}`;
                        } else {
                            labelText.textContent = `–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: ${files.length}`;
                        }
                        
                        showStatus(`–í—ã–±—Ä–∞–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤`, 'success');
                    }
                });
            });
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('fileToDecrypt').addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    const fileInfo = this.nextElementSibling.nextElementSibling;
                    
                    if (fileInfo && fileInfo.classList.contains('file-info')) {
                        fileInfo.innerHTML = `
                            <strong>–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª:</strong> ${file.name}<br>
                            <strong>–†–∞–∑–º–µ—Ä:</strong> ${formatFileSize(file.size)}<br>
                            <strong>–¢–∏–ø:</strong> ${file.type || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}
                        `;
                        fileInfo.style.display = 'block';
                    }
                    
                    showStatus(`–§–∞–π–ª "${file.name}" –≤—ã–±—Ä–∞–Ω`, 'success');
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            document.getElementById('iterations').addEventListener('change', saveSettings);
            document.getElementById('autoClear').addEventListener('change', saveSettings);
            document.getElementById('hidePasswords').addEventListener('change', saveSettings);
        }
    </script>
</body>
  </html>
